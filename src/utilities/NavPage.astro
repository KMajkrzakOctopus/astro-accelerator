---
import type { MarkdownInstance } from 'astro';

export type NavPage = {
  section: string;
  title: string;
  url: string;
  order: number;
  isOpen: boolean;
  ariaCurrent: 'page' | false;
  children: NavPage[];
}

export const mapNavPage = (page: MarkdownInstance<Record<string, any>>, currentUrl: URL) => {
  const url = page.url == null || (page.url ?? '').length == 0 ? '/' : page.url;
  const isCurrent = url == currentUrl.pathname;

  const entry: NavPage = {
    section: page.frontmatter.navSection ?? page.frontmatter.navTitle ?? page.frontmatter.title,
    title: page.frontmatter.navTitle ?? page.frontmatter.title,
    url: url,
    order: page.frontmatter.navOrder,
    isOpen: currentUrl.pathname.startsWith(url),
    ariaCurrent: isCurrent ? 'page' : false,
    children: [],
  }

  return entry;
};

export const popMatchingPage = (allPages: MarkdownInstance<Record<string, any>>[], search: string) => {
  const numberToRemove = 1;
  let indexToRemove = -1;
  let match = null;

  for (let i = 0; i < allPages.length; i++) {
    if (allPages[i].url == search) {
      indexToRemove = i;
      match = allPages[i];
    }
  }

  if (match) {
    allPages.splice(indexToRemove, numberToRemove);
  }

  return match;
};
---